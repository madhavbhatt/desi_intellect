import nmap
import csv
import bannergrabber

banners = []


def set_the_hound_on_loose(subnet):
    i = 0
    nm = nmap.PortScanner()
    nm.scan(hosts=subnet, arguments='-oX scan.xml')
    print ('host \t\tport \tstate \tbanner')
    for host in nm.all_hosts():
        for proto in nm[host].all_protocols():
            lport = nm[host][proto].keys()
            lport.sort()
            for port in lport:
                if nm[host][proto][port]['state'] == 'open':
                    banners.append(bannergrabber.hombre_grab_the_banner(host, port))
                    print ('%s \t%s \t%s \t%s' % (host, port, nm[host][proto][port]['state'], banners[i]))
                    i += 1



if __name__ == '__main__':
	print bannergrabber.hombre_grab_the_banner('10.11.1.8','80')
'''
nm = nmap.PortScanner()
nm.scan(hosts='10.255.0.0/16', arguments='-sn')


for host,state in hosts_list:
	print host + " : " + state

nmap -n -PN -sT -sU -p- host # to scan for every TCP / UDP port.
'''
