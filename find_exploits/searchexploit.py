import nmap
import os
import csv
import csvexport

firstLine = True
services = []
fileName = 'hound.csv'


def set_the_hound_on_loose(subnet):
    i = 0
    nm = nmap.PortScanner()
    nm.scan(hosts=subnet, arguments='-T4 -A -O')

    '''
    bloodscent = nm.get_nmap_last_output()
    evidence_locker = open('%s.xml' % subnet, 'w')
    evidence_locker.write(bloodscent)
    evidence_locker.close()
    follow_the_bloodtrail(subnet)
    '''
    csvEvidence = open(fileName, 'w')
    csvEvidence.write(nm.csv())
    csvEvidence.close()
    csvexport.cut_the_veggies(fileName)


def follow_the_bloodtrail():
    q = csv.reader(open('b.csv', 'r'))
    for row in q:
        if firstLine:  # skip first line
            firstLine = False
            continue
        if row[6] == 'open' and str(row[7]) != "":
            services.append(row[7].partition(' ')[0] + " " + row[10])
    chop_off_the_meat()


def chop_off_the_meat():
    for service in services:
        os.system("searchsploit -t %s | grep -v '/dos/'" % service)


if __name__ == '__main__':
    set_the_hound_on_loose('10.11.1.8')

'''                   
if __name__ == '__main__':
	print bannergrabber.hombre_grab_the_banner('10.11.1.8','80')
nm = nmap.PortScanner()
nm.scan(hosts='10.255.0.0/16', arguments='-sn')


for host,state in hosts_list:
	print host + " : " + state

nmap -n -PN -sT -sU -p- host # to scan for every TCP / UDP port.
'''
